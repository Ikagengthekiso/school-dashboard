<%= stylesheet_link_tag 'students', media: 'all' %>

<h1>All Enrolled Students</h1>

<form method="get" action="<%= students_path %>">
  <label for="grade_filter">Filter by Grade:</label>
  <select name="grade_id" id="grade_filter" onchange="this.form.submit()">
    <option value="">-- All Grades --</option>
    <% @grades.each do |grade| %>
      <option value="<%= grade.id %>" <%= 'selected' if grade == @selected_grade %>><%= grade.name %></option>
    <% end %>
  </select>
  <noscript><input type="submit" value="Filter"></noscript>
</form>

<div class="table-wrapper">
  <table>
    <thead>
      <tr>
        <th>Student #</th>
        <th>Name</th>
        <th>Email</th>
        <th>Grade</th>
        <th>Classroom</th>
        <th>Average</th>
      </tr>
    </thead>
    <tbody>
      <% @students.each do |student| %>
        <tr>
          <td><%= student.student_number %></td>
          <td><%= "#{student.first_name} #{student.last_name}" %></td>
          <td><%= student.email %></td>
          <td><%= student.grade.name %></td>
          <td><%= student.classroom.name %></td>
          <td>
            <% if student.results.any? %>
              <%= number_with_precision(student.results.average(:score), precision: 2) %>
            <% else %>
              N/A
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
